<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Tutoriel "composants d’interface Angular UI" - SGMAP</title>
  <link href="../dist/bootstrap.css" rel="stylesheet" />
  <link href="../dist/github.css" rel="stylesheet" />
  <link href="../styles.css" rel="stylesheet" />
</head>
<body>
  <header class="navbar navbar-inverse navbar-static-top" role="banner">
   <div class="container">
        <div class="navbar-header">
          <a href="index.html" class="navbar-brand">Tutoriel "composants d’interface JavaScript"</a>
        </div>
        <nav class="collapse navbar-collapse bs-navbar-collapse">
          <ul class="nav navbar-nav">
            <li>
              <a href="jquery-ui.html">Jquery-ui</a>
            </li>
            <li class="active">
              <a href="angular-ui.html" title="Angular-ui - page active">Angular-ui</a>
            </li>
            <li>
              <a href="react-bootstrap.html">React Bootstrap</a>
            </li>
            <li>
              <a href="reactjs.html">ReactJS</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </header>
  <main role="main" class="container" ng-app="ui.bootstrap.demo">
    <section>
      <header>
        <h1>Angular-ui <small>Tutoriel composants d’interface JavaScript</small></h1>
        <p lang="en" class="lead">Angular UI Bootstrap V2.2.0 + AngularJs v1.5.8</p>
      </header>

      <ul class="list-inline" id="overview">
        <li lang="en"><a href="#slider_link">Slider</a></li>
        <li lang="en"><a href="#progressbar_link">Progressbar</a></li>
        <li lang="en"><a href="#dialog_link">Dialog</a></li>
        <li lang="en"><a href="#tabpanel_link">Tabpanel</a></li>
        <li lang="en"><a href="#tooltip_link">Tooltip</a></li>
        <li lang="en"><a href="#accordion_link">Accordion</a></li>
        <li lang="en"><a href="#radiobutton_link">Radiobutton</a></li>
        <li lang="en"><a href="#checkbox_link">Checkbox</a></li>
        <li lang="en"><a href="#datepicker_link">Datepicker</a></li>
      </ul>

      <article>
        <header>
          <h2>Méthodologie</h2>
        </header>
        <p>
          AngularJS permet d'étendre le vocabulaire <abbr title="Hypertext Markup Language">HTML</abbr> et de créer des composants réutilisables.
        </p>
        <h3>Comment rendre une bibliothèque AngularJS accessible&nbsp;?</h3>
        <p>
          <a href="https://angular-ui.github.io/bootstrap" lang="en" title="Angular Bootstrap - Nouvelle fenêtre">Angular Bootstrap</a>
          offre un large panel de composants pouvant être testés suivant la grille <abbr title="Web Accessibility Initiative - Accessible Rich Internet Applications" lang="en">WAI-ARIA</abbr>. Cette bibliothèque est un très
          bon support pour illustrer notre exemple. Premièrement vous pouvez créer un module AngularJS qui étendra le module d'origine.
        </p>
        <pre>
          <code class="js" lang="en">var a11yBootstrapModule = angular.module('a11yBootstrap', ['ui.bootstrap']);</code>
        </pre>
        <p>
          Ici, vous pouvez injecter le module ui.bootstrap dans votre nouveau module. De cette façon, toutes les
          modifications dans a11yBootstrap n'interfèrent pas avec le module d'origine. Ce module va être enrichi
          par les corrections d'accessibilité.
        </p>
        <p>
          Dans AngularJS toute manipulation de <abbr title="Document Object Model" lang="en">DOM</abbr> doit passer par une directive. Voici un exemple de directive,
          nommée <code>maDirective</code>. Il est possible d'appeler sa directive avec le même nom que la bibliothèque
          <span lang="en">Angular Bootstrap</span> sans écraser celle d'origine, ce qui peut être pratique pour les
          corrections d'accessibilité. On peut, de plus, jouer sur 2 paramètres pour intervenir dans le <span lang="en">DOM</span> avant ou
          après la directive d'origine. On peut augmenter le paramètre <code lang="en">priority</code> pour intervenir
          avant la directive d'origine. Il est aussi possible d'utiliser le service <code lang="en">$timeout</code>
          pour être sûr d'intervenir en dernier sur <span lang="en">DOM</span>, ici avec la fonction <code lang="en">after</code>.
        </p>
        <pre>
          <code class="js" lang="en">
a11yBootstrapModule.directive('maDirective', ['$timeout', function($timeout){
  return {
    // priority: 10,
    link: function($scope, iElm, iAttrs, controller) {
      function after() {
        //Code exécuté après
      }
      $timeout(after);

    }
  };
}]);
          </code>
        </pre>

        <p>
          C'est dans la directive que nous allons manipuler le <span lang="en">DOM</span> et ajouter les gestionnaires d'événements.
          De manière générale, chaque gestionnaire d'événements ajouté au document ou en dehors du composant de la directive sera
          retiré à la destruction du <span lang="en">DOM</span>. Il faut pour cela attendre l'événement <code lang="en">$destroy</code>.
        </p>

        <pre>
          <code class="js" lang="en">
a11yBootstrapModule.directive('maDirective', ['$document', function($document){
  return {
    // priority: 10,
    link: function($scope, iElm, iAttrs, controller) {

      function escapeKeyBind () {
      }

      //Add escapeKeyBind
      $document.bind('keydown', escapeKeyBind);

      //on $destroy event
      $scope.$on('$destroy', function() {
        //remove escapeKeyBind
        $document.unbind('keydown', escapeKeyBind);
      });


    }
  };
}]);
          </code>
        </pre>

        <p>
          Une partie des corrections se fera directement dans les <span lang="en">templates</span>.
        </p>
      </article>

      <article>
        <header>
          <h2 id="slider_link" tabindex="-1" lang="en">Slider</h2>
        </header>
        <h3>Démonstration</h3>

        <div class="bs-example" ng-controller="RatingDemoCtrl">
          <h4 id="titre-slider">Exemple de composant <span lang="en">Slider</span> AngularJS</h4>

          <uib-rating
            ng-model="rate"
            max="max"
            read-only="isReadonly"
            on-hover="hoveringOver(value)"
            on-leave="overStar = null"
            aria-labelledby="titre-slider"
          ></uib-rating>
          <span class="label" ng-class="{'label-warning': percent<30, 'label-info': percent>=30 && percent<70, 'label-success': percent>=70}" ng-show="overStar && !isReadonly">{{percent}}%</span>

          <pre style="margin:15px 0;">Valeur: <b>{{rate}}</b> - Lecture seule: <i>{{isReadonly}}</i> - Valeur au survol: <b>{{overStar || "none"}}</b></pre>

          <button type="button" class="btn btn-sm btn-danger" ng-click="rate = 0" ng-disabled="isReadonly">Remettre à zéro</button>
          <button type="button" class="btn btn-sm btn-default" ng-click="isReadonly = ! isReadonly">Activer la lecture seule</button>
        </div>

        <p>Pour ce composant, les erreurs relevées sont&nbsp;:</p>
        <ul>
          <li>l’absence de titre du composant, aucun titre ne doit être vocalisé lors de la prise de <span lang="en">focus</span> sur le composant ;</li>
          <li>l’absence ou la malformation d'une valeur enrichie, qui sera verbalisée à la place de la valeur courante du <span lang="en">slider</span> et qui doit être composée de la valeur courante et d'un texte en suffixe.</li>
        </ul>

        <h3>Corrections</h3>
        <ul>
          <li>Lors de la définition du composant, il faut ajouter un attribut <code lang="en">title=""</code> ou <code lang="en">aria-labelledby="[ID]"</code>, [ID] faisant référence à un identifiant de la page ;</li>
          <li>Pour la valeur enrichie, il est possible d'agir directement sur le <span lang="en">template</span> et modifier la valeur de l'attribut <code lang="en">aria-valuetext</code> ;</li>
          <li>Il nous faut également modifier la directive <code lang="en">uibRating</code> (propriété restrict). En effet, nous voulons pouvoir utiliser cette directive en tant qu'élément et non pas en tant qu'attribut comme cela est proposé. Cela permet à la directive de contrôler son <span lang="en">template</span> et ainsi d'éviter d'avoir certains attributs liés à l'accessibilité tel qu'<code lang="en">aria-labelledby</code> sur un élément du DOM qui n'est pas tabulable et ainsi perdre des informations à la vocalisation.</li>
        </ul>

        <div class="highlight-doc">
          <pre><code class="html" lang="en">&lt;h4 id=&quot;titre-slider&quot;&gt;Exemple de composant AngularJS&lt;/h4&gt;>
&lt;uib-rating aria-labelledby=&quot;titre-slider&quot; ng-model=&quot;rate&quot; max=&quot;max&quot; read-only=&quot;isReadonly&quot; on-hover=&quot;hoveringOver(value)&quot; on-leave=&quot;overStar = null&quot; &gt;&lt;/uib-rating&gt;
          </code></pre>
        </div>
        <p>Voici le <span lang="en">template</span> corrigé&nbsp;:</p>
        <div class="highlight-doc">
          <pre>
            <code class="js" lang="en" ng-non-bindable>
angular.module('uib/template/rating/rating.html', []).run(['$templateCache', function($templateCache) {
  $templateCache.put(
    'uib/template/rating/rating.html',
    '&lt;span ng-mouseleave=\"reset()\" ng-keydown=\"onKeydown($event)\" tabindex=\"0\" role=\"slider\" aria-valuemin=\"0\" aria-valuemax=\"{{range.length}}\" aria-valuenow=\"{{value}}\" aria-valuetext=\"{{value}} étoile{{ value > 1 ? \'s\' :  \'\' }}\"&gt;\n' +
    '    &lt;span ng-repeat-start=\"r in range track by $index\" class=\"sr-only\"&gt;({{ $index < value ? \'*\' : \' \' }})&lt;/span&gt;\n' +
    '    &lt;i ng-repeat-end ng-mouseenter=\"enter($index + 1)\" ng-click=\"rate($index + 1)\" class=\"glyphicon\" ng-class=\"$index &lt; value && (r.stateOn || \'glyphicon-star\') || (r.stateOff || \'glyphicon-star-empty\')\" ng-attr-title=\"{{r.title}}\"&gt;&lt;/i&gt;\n' +
    '&lt;/span&gt;\n' +
  '');
}]);
            </code>
          </pre>
        </div>

        <p>Et la directive&nbsp;:</p>
        <p>
          On modifie donc le paramètre <code lang="en">restrict: 'A'</code> en <code lang="en">restrict: 'E'</code> et on ajoute la propriété <code lang="en">replace: true</code> afin de remplacer l'élément dans le DOM par son <span lang="en">template</span>.
        </p>
        <div class="highlight-doc">
          <pre>
            <code class="js" lang="en">
a11yBootstrapModule.directive('uibRating', function() {
  return {
    priority: 10000,
    require: ['uibRating', 'ngModel'],
    restrict: 'E',
    replace: true,
    scope: {
      readonly: '=?readOnly',
      onHover: '&',
      onLeave: '&'
    },
    controller: 'UibRatingController',
    templateUrl: 'uib/template/rating/rating.html',
    link: function(scope, element, attrs, ctrls) {
      var ratingCtrl = ctrls[0], ngModelCtrl = ctrls[1];
      ratingCtrl.init(ngModelCtrl);
    }
  };
});
            </code>
          </pre>
        </div>
      </article>

      <article>
        <header>
          <h2 id="progressbar_link" tabindex="-1" lang="en">Progressbar</h2>
        </header>

        <div>
          <h3 id="titre-progress">Démonstration</h3>


          <div class="bs-example" ng-controller="ProgressDemoCtrl">
            <uib-progressbar animate="false" title="titre-progress" id="progressbar" value="dynamic" type="success">
              <b>{{dynamic}}%</b>
            </uib-progressbar>
            <div id="region" aria-busy="{{busy}}" aria-describedby="progressbar">
              <p>Région mise à jour par la progressbar</p>
              <button class="btn btn-sm btn-primary" type="button" ng-click="start()">Démarrer</button>
            </div>
            <br />

            <p>Progressbar avec valeur courante inconnue :</p>
            <uib-progressbar value="" title="titre-progress"></uib-progressbar>
          </div>
        </div>

        <h3>Corrections</h3>

        <p>Plusieurs améliorations sont nécessaires pour rendre ce composant accessible :</p>

        <ul>
          <li>
            La <span lang="en">Progressbar</span> doit posséder un attribut
            <code lang="en">title</code> ou <code lang="en">aria-labelledby</code>
            faisant office de nom ;
          </li>
          <li>
            La <span lang="en">Progressbar</span> doit être focusable et les attributs liés à l'accessibilité ne doivent pas être dispersés sur deux éléments du DOM.
          </li>
        </ul>

        <p>Si la <span lang="en">Progressbar</span> a une valeur courante inconnue&nbsp;:</p>

        <ul>
          <li>
            Le composant ne doit pas posséder de propriété <code lang="en">aria-valuenow</code> ;
          </li>
          <li>
            Le composant ne doit pas posséder de propriété <code lang="en">aria-valuetext</code> ;
          </li>
        </ul>

        <p>Si la <span lang="en">Progressbar</span> met à jour une zone de l'interface&nbsp;:</p>

        <ul>
          <li>
            Cette zone doit comporter un attribut <code lang="en">aria-describedby="id-de-la-progress-bar"</code>
            qui la lie à la <span lang="en">Progressbar</span> ;
          </li>
          <li>
            Lorsqu'une mise à jour est en cours, la zone doit comporter un attribut
            <code lang="en">aria-busy="true"</code>, indiquant que son contenu est
            en cours de mise à jour.
          </li>
        </ul>

        <p>
          On peut utiliser directement l'attribut <code lang="en">title</code> du composant qui ajoute également à la compilation une propriété <code lang="en">aria-labelledby</code> qui du coup n'est plus nécessaire.
        </p>
        <p>
          On modifie également le <span lang="en">template</span> afin de mettre les attributs liés à l'accessibilité sur le conteneur et non pas sur l'élément utile pour le style. On ajoute également au passage un <code lang="en">tabindex="0"</code> afin de permettre le focus.
        </p>


        <div class="highlight-doc">
          <pre>
            <code class="html" lang="en" ng-non-bindable>
&lt;h3 id="titre-progress">Dynamic&lt;/h3>
&lt;uib-progressbar animate="false" title="titre-progress" value="dynamic" type="success">
  &lt;b>{{dynamic}}%&lt;/b>
&lt;/uib-progressbar>
            </code>
          </pre>
        </div>

        <div class="highlight-doc">
          <pre>
            <code class="js" lang="en" ng-non-bindable>
angular.module('uib/template/tabs/tabset.html', []).run(['$templateCache', function($templateCache) {
  $templateCache.put(
    'uib/template/progressbar/progressbar.html',
    '&lt;div class=\"progress\" tabindex=\"0\" aria-labelledby=\"{{::title}}\" role=\"progressbar\" aria-valuenow=\"{{value}}\" aria-valuemin=\"0\" aria-valuemax=\"{{max}}\" aria-valuetext=\"{{percent | number:0}}%\" aria-labelledby=\"{{::title}}\"&gt;\n' +
    ' &lt;div  class=\"progress-bar\" ng-class=\"type && \'progress-bar-\' + type\"  ng-style=\"{width: (percent < 100 ? percent : 100) + \'%\'}\" ng-transclude&gt;&lt;/div&gt;\n' +
    '&lt;/div&gt;\n' +
  '');
}]);
            </code>
          </pre>
        </div>

        <p>
         Pour se conformer au cas où la Progressbar n'a pas de valeur courante connue, on ajoute une directive permettant de supprimer les attributs <code lang="en">aria-valuenow</code> et <code lang="en">aria-valuetext</code>.
        </p>

        <div class="highlight-doc">
          <pre>
            <code class="js" lang="en">
a11yBootstrapModule.directive('uibProgressbar', ['getUID', '$timeout',function(getUID, $timeout){
return {
  priority: 10000,
  link: function($scope, iElm) {

    function render() {
      if (iElm[0].getAttribute('value') === "") {
        angular.element(iElm).removeAttr('aria-valuenow');
        angular.element(iElm).removeAttr('aria-valuetext');
      }
    }

    $timeout(render, 0);
  }
};
}]);
            </code>
          </pre>
        </div>


        <p>
          Dans le cas ou la <span lang="en">Progressbar</span> met à jour une zone
          de l'interface, il est nécessaire de renseigner plusieurs informations pour
          les lier ensemble.
        </p>
        <p>
          On peut ajouter directement l'attribut <code lang="en">aria-describedby</code> HTML ainsi que l'id sur le composant.
          Il faut ensuite piloter la valeur de <code lang="en">$scope.busy</code> dans le contrôleur de l'application suivant l'état du chargement.
        </p>

        <div class="highlight-doc">
          <pre>
            <code class="html" lang="en" ng-non-bindable>
&lt;uib-progressbar animate="false" title="titre-progress" id="progressbar" value="dynamic" type="success">
  &lt;b>{{dynamic}}%&lt;/b>
&lt;/uib-progressbar>
&lt;div id="region" aria-busy="{{busy}}" aria-describedby="progressbar">
  &lt;p>Région mise à jour par la progressbar&lt;/p>
  &lt;button class="btn btn-sm btn-primary" type="button" ng-click="start()">Démarrer&lt;/button>
&lt;/div>
            </code>
          </pre>
        </div>

        <div class="highlight-doc">
          <pre>
            <code class="js" lang="en">
//Exemple
app.controller('ProgressDemoCtrl', ['$scope', '$timeout',function ($scope, $timeout) {
  $scope.busy = false;
  $scope.dynamic = 0;

  $scope.start = function() {
    progress();
  };

  function progress() {

    $scope.busy = true;

    if ( $scope.dynamic < 100 ) {
      $scope.dynamic++;
      $timeout( progress, 50 );
    }else{
      $scope.busy = false;
    }
  }
}]);
            </code>
          </pre>
        </div>
      </article>

      <article id="tuto-tabs">
        <header>
          <h2 id="tabpanel_link" tabindex="-1" lang="en">Tabpanel</h2>
        </header>

        <div>
          <h3>Démonstration</h3>

          <div class="bs-example" ng-controller="TabsDemoCtrl">

            <uib-tabset active="active">
              <uib-tab heading="Titre statique 1">Contenu statique</uib-tab>
              <uib-tab heading="Titre statique 2">Contenu statique avec un <a href="#">lien</a></uib-tab>
              <uib-tab ng-repeat="tab in tabs" heading="{{tab.title}}" active="tab.active" disabled="tab.disabled">
                {{tab.content}}
              </uib-tab>
            </uib-tabset>
          </div>
        </div>

        <div>
          <h3>Corrections</h3>

          <p>Plusieurs améliorations sont nécessaires pour rendre ce composant accessible&nbsp;:</p>

          <ul>
            <li>La liste d'onglets doit posséder un attribut <code lang="en">role="tablist"</code> ;</li>
            <li>Chaque onglet doit posséder un attribut <code lang="en">role="tab"</code> ;</li>
            <li>Chaque panneau doit posséder un attribut <code lang="en">role="tabpanel"</code> ;</li>
            <li>
              Chaque onglet actif doit posséder un attribut <code lang="en">aria-selected="true"</code>
              (ou <code lang="en">"false"</code> s'il est inactif) pour préciser son état ;
            </li>
            <li>
              Chaque onglet doit posséder un attribut <code lang="en">aria-controls="id-du-panneau"</code>
              qui le lie au panneau qu'il contrôle ;
            </li>
            <li>
              Chaque panneau doit posséder un attribut <code lang="en">aria-labelledby="id-de-l-onglet"</code>
              qui le lie à l'onglet qui le contrôle ;
            </li>
            <li>
              À partir du titre d’un onglet, si le panneau n’est pas activé par défaut, la touche  <kbd>Espace</kbd> ne permet pas d’activer le panneau ;
            </li>
            <li>
              Depuis un onglet, les touches <kbd title="haut">↑</kbd> et <kbd title="gauche">←</kbd>
              doivent permettre d'atteindre l'onglet précédent ;
            </li>
            <li>
              Depuis un onglet, les touches <kbd title="bas">↓</kbd> et <kbd title="droite">→</kbd>
              doivent permettre d'atteindre l'onglet suivant ;
            </li>
          </ul>

          <p ng-non-bindable>
            Il faut dans un premier temps corriger le <span lang="en">template</span> par défaut. On peut facilement ajouter les attributs <code lang="en">role</code>
            <span lang="en">tablist</span> et <span lang="en">tabpanel</span> sur le <span lang="en">template</span> <code lang="en">uib/template/tabs/tabset.html</code>.
            On peut ensuite ajouter le <code lang="en">role</code> <span lang="en">tab</span> sur le <code lang="en">uib/template/tabs/tab.html</code>.
            Pour corriger <code lang="en">aria-selected="true"</code> sur le <span lang="en">template</span> <code lang="en">uib/template/tabs/tab.html</code>
            on peut utiliser une expression Angular pour changer la valeur en fonction du <code lang="en">$scope</code> active. Ce qui donne
            <code lang="en">aria-selected="{{active ? 'true' : 'false'}}"</code>.
          </p>

          <div class="highlight-doc">
            <pre>
              <code class="js" lang="en" ng-non-bindable>
angular.module('uib/template/tabs/tabset.html', []).run(['$templateCache', function($templateCache) {
    $templateCache.put(
      'uib/template/tabs/tabset.html',
      '&lt;div&gt;\n' +
      '&lt;ul role="tablist" class="nav nav-{{type || \'tabs\'}}" ng-class="{\'nav-stacked\': vertical, \'nav-justified\': justified}" ng-transclude&gt;&lt;/ul&gt;\n' +
      '&lt;div class="tab-content"&gt;\n' +
        '&lt;div role="tabpanel" class="tab-pane"\n' +
        'ng-repeat="tab in tabset.tabs"\n' +
        'tabindex="0"\n' +
        'ng-class="{active: tabset.active === tab.index}"\n' +
        'uib-tab-content-transclude="tab"&gt;\n' +
        '&lt;/div&gt;\n' +
      '&lt;/div&gt;\n' +
    '&lt;/div&gt;\n' +
      '');
}]);

angular.module('uib/template/tabs/tab.html', []).run(['$templateCache', function($templateCache) {
   $templateCache.put(
    'uib/template/tabs/tab.html',
    '&lt;li role="tab" ng-class="{active: active, disabled: disabled}" aria-selected="{{active ? \'true\' : \'false\'}}"&gt;\n' +
    '&lt;a tabindex="{{active ? \'0\' : \'-1\'}}" href ng-click="select()" tab-heading-transclude>{{heading}}&lt;/a&gt;\n' +
  '&lt;/li&gt;\n' +
    '');
}]);
              </code>
            </pre>
          </div>

          <p>
            Pour corriger <code lang="en">aria-controls="id-du-panneau"</code> et <code lang="en">aria-labelledby="id-de-l-onglet"</code>,
            il faut procéder en 2 étapes&nbsp;: d'abord créer un id unique, puis placer correctement l'id dans le DOM.
          </p>

          <p>
            Il faut créer une factory qui renvoie un id unique. Cette fonction prend en paramètre un préfixe puis cherche dans le document
            un id unique aléatoirement.
          </p>

          <div class="highlight-doc">
            <pre>
              <code class="js" lang="en">
a11yBootstrapModule.factory('getUID', function(){
  return function(prefix){
    do {
      prefix += Math.floor(Math.random() * 1000000);
    } while (document.getElementById(prefix));
    return prefix;
  };
});
              </code>
            </pre>
          </div>

          <p>
            Nous allons maintenant placer cet id unique dans le DOM. Nous allons donc injecter notre <code lang="en">factory getUID</code>
            dans la directive. Nous avons besoin d'ajouter les id après le rendu du DOM, il faut pour cela ajouter le service
            <code lang="en">$timeout</code>. Ainsi la fonction <code lang="en">render()</code> sera appliquée après le rendu du DOM.
          </p>

          <div class="highlight-doc">
            <pre>
              <code class="js" lang="en">
a11yBootstrapModule.directive('uibTabset', ['getUID', '$timeout',function(getUID, $timeout){
  return {
    link: function($scope, iElm, iAttrs, controller) {


      function render() {}

      $timeout(render,0);

    }
  };
}]);
              </code>
            </pre>
          </div>

          <p>
            Dans un premier temps, il faut récupérer le tableau de <span lang="en">tabs</span> et de <span lang="en">tabpanels</span>,
            puis le pacourir avec un <code lang="en">forEach</code>.
            Pour chaque tab nous devons générer un id unique, y affecter et ajouter l'attribut <code lang="en">aria-labelledby</code>
            au panel correspondant. De la même manière, pour chaque panel, il faut générer un id unique, puis affecter et ajouter l'attribut
            <code lang="en">aria-controls</code> au <span lang="en">tab</span> correspondant.
          </p>

          <div class="highlight-doc">
            <pre>
              <code class="js" lang="en">
a11yBootstrapModule.directive('uibTabset', ['getUID', '$timeout',function(getUID, $timeout){
  return {
    link: function($scope, iElm, iAttrs, controller) {


      function render() {

        var tablist = iElm[0].firstElementChild;
        var tabs = angular.element(tablist).children();

        var tabContent = iElm[0].lastElementChild;
        var tabpanels = angular.element(tabContent).children();

        angular.forEach(angular.element(tabs), function(value, key){

          var tab = angular.element(value);
          var panel = angular.element(tabpanels[key]);

          var idtab = getUID('tab-');
          tab.attr('id', idtab);
          panel.attr('aria-labelledby', idtab);

          var idpanel = getUID('panel-');
          panel.attr('id', idpanel);
          tab.attr('aria-controls', idpanel);

        });
      }

      $timeout(render, 0);

    }
  };
}]);
              </code>
            </pre>
          </div>

          <p>
            Pour la correction de la gestion clavier, on peut reprendre la <a href="#keyboard-rotate">directive <code lang="en">keyboardRotate</code></a> avec
            le paramètre <code lang="en">recursion</code> à 1 et <code lang="en">autoClick</code> à 0. On a donc ajouté <code lang="en">keyboard-rotate="{recursion: 1, autoClick: 0}"</code> à notre <span lang="en">template</span>. Si le but est d'activer automatiquement l'onglet à la navigation, il faut alors mettre le paramètre <code lang="en">autoClick</code> à 1.
          </p>

          <div class="highlight-doc">
            <pre>
              <code class="js" lang="en" ng-non-bindable>
angular.module('uib/template/tabs/tabset.html', []).run(['$templateCache', function($templateCache) {
    $templateCache.put(
      'uib/template/tabs/tabset.html',
      '&lt;div&gt;\n' +
      '&lt;ul role="tablist" keyboard-rotate="{recursion: 1, autoClick: 0}" class="nav nav-{{type || \'tabs\'}}" ng-class="{\'nav-stacked\': vertical, \'nav-justified\': justified}" ng-transclude&gt;&lt;/ul&gt;\n' +
      '&lt;div class="tab-content"&gt;\n' +
        '&lt;div role="tabpanel" class="tab-pane"\n' +
        'ng-repeat="tab in tabset.tabs"\n' +
        'tabindex="0"\n' +
        'ng-class="{active: tabset.active === tab.index}"\n' +
        'uib-tab-content-transclude="tab"&gt;\n' +
        '&lt;/div&gt;\n' +
      '&lt;/div&gt;\n' +
    '&lt;/div&gt;\n' +
      '');
}]);
              </code>
            </pre>
          </div>

        </div>
      </article>

      <article>
        <header>
          <h2 id="tooltip_link" tabindex="-1" lang="en">Tooltip</h2>
        </header>

        <div>
          <h3>Démonstration</h3>

          <div class="bs-example" ng-controller="TooltipDemoCtrl">
            <form role="form">
              <div class="form-group">
                <label>Affichage au clic
                  <input type="text" value="Cliquez !" uib-tooltip="Vous me voyez ?" tooltip-trigger="'focus'" tooltip-placement="right" class="form-control" />
                </label>
              </div>
            </form>
          </div>
        </div>

        <h3>Corrections</h3>

        <p>Plusieurs améliorations sont nécessaires pour rendre ce composant accessible&nbsp;:</p>

        <ul>
          <li>Le <span lang="en">tooltip</span> doit posséder un attribut <code lang="en">role="tooltip"</code> ;</li>
          <li>Le texte doit être lié au <span lang="en">tooltip</span> par un attribut <code lang="en">aria-describedby</code>.</li>
        </ul>

        <p>
          Pour corriger et manipuler le DOM, il faut créer une directive du même nom d'origine, <code lang="en">uibTooltipPopup</code>.
          Lors de la création du <span lang="en">tooltip</span>, il faut ajouter son <code lang="en">role</code> et un identifiant unique.
          On va pouvoir ici réutiliser la <code lang="en">factory getUID</code> pour générer un id unique.
        </p>

        <p>
          On peut de cette façon ajouter un id au <span lang="en">tooltip</span>, et l'attribut <code lang="en">aria-describedby</code>
          à l'élément d'origine.
        </p>

        <p>
          Lors de la destruction, il faut retirer l'attribut <code lang="en">aria-describedby</code> de l'élément d'origine.
        </p>

        <div class="highlight-doc">
          <pre>
            <code class="js" lang="en">
a11yBootstrapModule.directive('uibTooltipPopup', ['getUID',function(getUID){
  return {
    link: function($scope, iElm) {

    // Add role tooltip
    iElm.attr('role', 'tooltip');
    // Add a Unique ID
    var idtooltip = getUID('tooltip-');
    iElm.attr('id', idtooltip);
    // Add aria-describedby on previousElementSibling
    var originElement = angular.element(iElm[0].previousElementSibling);
    originElement.attr('aria-describedby', idtooltip);

    // remove aria-describedby on destroy
    $scope.$on('$destroy',function() {
      originElement.removeAttr('aria-describedby');
    });

    }
  };
}]);
            </code>
          </pre>
        </div>
      </article>




      <article>
        <header>
          <h2 id="accordion_link" tabindex="-1" lang="en">Accordion</h2>
        </header>

        <div>
          <h3>Démonstration</h3>

          <div lang="en" class="bs-example" ng-controller="AccordionDemoCtrl">

            <div class="checkbox">
              <label>
                <input type="checkbox" ng-model="oneAtATime">
                Ouverture d'un seul panneau à la fois
              </label>
            </div>
            <uib-accordion aria-multiselectable="{{!oneAtATime}}" close-others="oneAtATime">
              <div uib-accordion-group class="panel-default" heading="Panneau initialement ouvert" is-open="status.isFirstOpen" is-disabled="status.isFirstDisabled">
                Ce contenu est défini dans le <span lang="en">template</span>.
              </div>
              <div uib-accordion-group class="panel-default" heading="Contenu dynamique">
                <p>La taille du panneau s'adapte au contenu.</p>
                <button type="button" class="btn btn-default btn-sm" ng-click="addItem()">Ajouter un élément</button>
                <div ng-repeat="item in items">{{item}}</div>
              </div>
              <div uib-accordion-group class="panel-default" is-open="status.open">
                <div uib-accordion-heading>
                  HTML dans l'en-tête <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': status.open, 'glyphicon-chevron-right': !status.open}"></i>
                </div>
                Un peu de contenu pour illustrer les en-têtes HTML.
              </div>
            </uib-accordion>
          </div>
        </div>

        <div>
          <h3>Corrections</h3>

          <p>Plusieurs améliorations sont nécessaires pour rendre ce composant accessible&nbsp;:</p>

          <ul>
            <li>
              Le composant possède la propriété <code lang="en">aria-multiselectable="true" ;</code>
            </li>
            <li>
              De l'extérieur du composant, lorsqu'un panneau est actif, le <span lang="en">focus</span> est donné sur le titre du premier panneau actif ;
            </li>
            <li>
              Depuis un titre, les touches <kbd title="haut">↑</kbd> et <kbd title="gauche">←</kbd>
              doivent permettre d'atteindre le titre précédent ;
            </li>
            <li>
              Depuis un titre, les touches <kbd title="bas">↓</kbd> et <kbd title="droite">→</kbd>
              doivent permettre d'atteindre le titre suivant ;
            </li>
            <li>
              Les attributs liés à l'accessibilité doivent être sur un unique élément focusable afin d'être restitués par les technologies d'assistance.
            </li>
          </ul>

          <p>
            On peut ajouter à l'aide d'une directive l'attribut <code lang="en">aria-multiselectable="true"</code> selon que l'on veuille ou non, ouvrir plusieurs panneaux en même temps. Cela dépend de la valeur de l'attribut <code lang="en">close-others</code>. Si celui-ci est présent alors on peut ouvrir plusieurs panneaux, sinon le comportement par défaut ferme les autres panneaux à l'ouverture.
          </p>

          <div class="highlight-doc">
            <pre>
              <code class="js" lang="en" ng-non-bindable>
angular.directive('group', function ($timeout) {
  return {
    restrict:'EA',
    controller:'GroupController',
    priority: 100000,
    link: function(scope, element, attrs, groupCtrl) {
      $timeout(function() {

        const closeOthers = element[0].parentElement.getAttribute('close-others');
        if (closeOthers) {
          element.attr('aria-multiselectable', 'true');
        } else {
          element.attr('aria-multiselectable', 'false');
        }
      }, 0);
    }
  };
]);
              </code>
            </pre>
          </div>

          <p>
            Pour corriger la gestion clavier le composant d'origine n'expose pas correctement les bons paramètres. Il faut donc réimplémenter complétement la gestion clavier
            en reprenant les directives <code lang="en">accordionGroup</code>, <code lang="en">accordion</code> et le contrôleur <code lang="en">AccordionController</code> puis les ajouter à notre <span lang="en">template</span> corrigé. <br />
            On modifie également le <span lang="en">template</span> en ajoutant à la balise <code lang="en">&lt;a&gt;</code> les attributs liés à l'accessibilité tel que l'attribut <code lang="en">role="tab"</code> et <code lang="en">aria-selected="true|false"</code>.
          </p>

          <div class="highlight-doc">
            <pre>
              <code class="js" lang="en">


.controller('GroupController', ['$scope', '$attrs', 'accordionConfig', function ($scope, $attrs, accordionConfig) {

  // This array keeps track of the accordion groups
    this.groups = [];
    this.groupsElem = [];


    // This is called from the accordion-group directive to add itself to the accordion
    this.addGroup = function(groupScope, element) {
      var that = this;
      this.groups.push(groupScope);
      this.groupsElem.push(element);
      groupScope.$on('$destroy', function (event) {
        that.removeGroup(groupScope);
      });
    };

    // This is called from the accordion-group directive when to remove itself
    this.removeGroup = function(group) {
      var index = this.groups.indexOf(group);
      if ( index !== -1 ) {
        this.groups.splice(index, 1);
        this.groupsElem.splice(index, 1);
      }
    };

    this.initFocusable = function() {
      var that = this;
      const index = this.groups.findIndex(function(element) {
        return element.isFocused;
      });
      this.groups.indexSelected = index !== -1 ? index : 0;
      this.changeSelected();
    };

    this.nextFocusable = function(change) {
      this.groups.indexSelected = this.modulo(this.groups.indexSelected + change,this.groups.length);
      this.changeSelected();
      var focusElement = this.groupsElem[this.groups.indexSelected];
      focusElement[0].focus();
    };

    this.elemFocus = function(group) {
      var index = this.groups.indexOf(group);
      this.groups.indexSelected = index;
      this.changeSelected();
    };

    this.changeSelected = function() {
      var that = this;
      angular.forEach(this.groups, function (group, index) {
        group.isFocused = false;
        if ( index === that.groups.indexSelected ) {
          group.isFocused = true;
        }
      });
    };

    this.modulo = function(i, iMax) {
      return ((i % iMax) + iMax) % iMax;
    };

}])

// The group directive simply sets up the directive controller
.directive('group', function ($timeout) {
  return {
    restrict:'EA',
    controller:'GroupController',
    priority: 100000,
    link: function(scope, element, attrs, groupCtrl) {
      $timeout(function() {
        groupCtrl.initFocusable();

        const closeOthers = element[0].parentElement.getAttribute('close-others');
        if (closeOthers) {
          element.attr('aria-multiselectable', 'true');
        } else {
          element.attr('aria-multiselectable', 'false');
        }
      }, 0);
    }
  };
})

// The group-item directive indicates a block of html that will expand and collapse in an accordion
.directive('groupItem', ['$timeout',function($timeout) {
  return {
    require:'^group',
    restrict:'EA',
    priority: 10000,
    scope: true,
    link: function(scope, element, attrs, groupCtrl) {
      scope.isFocused = scope.$parent.isOpen ? true : false;
      groupCtrl.addGroup(scope, element);

      function KeyTrap (evt) {
        var keyCode = evt.keyCode;
        // Right key and up key
        if (keyCode === 39 || keyCode === 40) {
          groupCtrl.nextFocusable(1);
          scope.$apply();
        }
        // Left key and down key
        if (keyCode === 37 || keyCode === 38) {
          groupCtrl.nextFocusable(-1);
          scope.$apply();
        }
      }

      element.on('keydown',KeyTrap);
      element.on('click', function() {
        groupCtrl.elemFocus(scope);
        scope.$apply();
      });

    }
  };
}])
              </code>
            </pre>
          </div>

          <p ng-non-bindable>
              Voici le <span lang="en">template</span> final corrigé avec l'ajout de ces directives. <br />
              Afin que le <span lang="en">focus</span> soit donné sur le titre du premier panneau actif, des <code lang="en">tabindex</code> sont utilisés. Leur valeur est mise à jour en fonction de la valeur de l'attribut <code lang="en">isFocused</code>. <br />
              L'attribut <code lang="en">isOpen={{isOpen}}</code> a également été ajouté afin de pouvoir bénéficier de l'état du panneau dans la directive <code lang="en">groupItem</code> et ainsi initialiser correctement le contrôleur.
          </p>

          <div class="highlight-doc">
            <pre>
              <code class="js" lang="en" ng-non-bindable>
angular.module('uib/template/accordion/accordion-group.html', []).run(['$templateCache', function($templateCache) {
  $templateCache.put(
    'uib/template/accordion/accordion-group.html',
    '&lt;div class=\"panel-heading\"&gt;\n' +
    '  &lt;h4 class=\"panel-title\"&gt;\n' +
    '    &lt;a group-item role=\"tab\" id=\"{{::headingId}}\" aria-selected=\"{{!!isOpen}}\" ng-keypress=\"toggleOpen($event)\" isOpen={{isOpen}} tabindex="{{isFocused ? \'0\' : \'-1\'}}" data-toggle=\"collapse\" href aria-expanded=\"{{!!isOpen}}\" aria-controls=\"{{::panelId}}\" class=\"accordion-toggle\" ng-click=\"toggleOpen()\" uib-accordion-transclude=\"heading\" ng-disabled=\"isDisabled\"&gt;&lt;span uib-accordion-header ng-class=\"{\'text-muted\': isDisabled}\"&gt;{{heading}}&lt;/span&gt;&lt;/a&gt;\n' +
    '  &lt;/h4&gt;\n' +
    '&lt;/div&gt;\n' +
    '&lt;div id=\"{{::panelId}}\" aria-labelledby=\"{{::headingId}}\" aria-hidden=\"{{!isOpen}}\" role=\"tabpanel\" class=\"panel-collapse collapse\" uib-collapse=\"!isOpen\"&gt;\n' +
    '  &lt;div class=\"panel-body\" ng-transclude&gt;&lt;/div&gt;\n' +
    '&lt;/div&gt;\n' +
    '');
}]);

angular.module('uib/template/accordion/accordion.html', []).run(['$templateCache', function($templateCache) {
  $templateCache.put(
   'uib/template/accordion/accordion.html',
   '&lt;div group role="tablist" class="panel-group" ng-transclude&gt;&lt;/div&gt;'
  );
}]);
              </code>;
            </pre>
          </div>
        </div>
      </article>


      <article>
        <h2 id="radiobutton_link" tabindex="-1" lang="en">Radiobutton </h2>

        <h3>Démonstration</h3>

        <div class="bs-example">
          <div ng-controller="RadioButtonsCtrl">
            <pre>{{radioModel || 'null'}}</pre>
            <div class="btn-group" role="radiogroup" keyboard-rotate="{recursion: 0, autoClick: 1}">
              <button type="button" class="btn btn-primary" role="radio" ng-model="radioModel" uib-btn-radio="'Gauche'">Gauche</button>
              <button type="button" class="btn btn-primary" role="radio" ng-model="radioModel" uib-btn-radio="'Centre'">Centre</button>
              <button type="button" class="btn btn-primary" role="radio" ng-model="radioModel" uib-btn-radio="'Droite'">Droite</button>
            </div>
          </div>
        </div>

        <p>Pour ce composant, les erreurs relevées sont&nbsp;:</p>
        <ul>
          <li>Le composant ne possède pas de <code lang="en">role="radiogroup"</code>, et aucun bouton n'est sélectionné ;</li>
          <li>les éléments représentants les boutons radio ne possèdent pas la propriété <code lang="en">role="radio"</code> ;</li>
          <li>Lorsque un élément n'est pas sélectionné, il ne possède pas la propriété <code lang="en">aria-checked="false"</code> ;</li>
          <li>Lorsque un élément est sélectionné, il ne possède pas la propriété <code lang="en">aria-checked="true"</code> ;</li>
          <li>Aucune interaction au clavier n'est possible avec les touches <kbd title="haut">↑</kbd>, <kbd title="bas">↓</kbd>, <kbd title="droite">→</kbd>, <kbd title="gauche">←</kbd> ou <kbd title="tabulation">Tab</kbd>.</li>
        </ul>

        <h3>Corrections</h3>
        <div class="bs-callout bs-callout-info">
          <h4>Gestion des propriété des composants</h4>
          <p>Pour cela, il suffit d'ajouter les propriétés <code lang="en">role="radiogroup"</code> et <code lang="en">role="radio"</code> sur les éléments lors de l'initialisation du composant.</p>
        </div>
        <div class="highlight-doc">
          <pre><code class="html" lang="en" ng-non-bindable>&lt;div class=&quot;btn-group&quot; role=&quot;radiogroup&quot;&gt;
  &lt;label class=&quot;btn btn-primary&quot; role=&quot;radio&quot; ng-model=&quot;radioModel&quot; uib-btn-radio=&quot;&#39;Gauche&#39;&quot;&gt;Gauche&lt;/label&gt;
  &lt;label class=&quot;btn btn-primary&quot; role=&quot;radio&quot; ng-model=&quot;radioModel&quot; uib-btn-radio=&quot;&#39;Centre&#39;&quot;&gt;Centre&lt;/label&gt;
  &lt;label class=&quot;btn btn-primary&quot; role=&quot;radio&quot; ng-model=&quot;radioModel&quot; uib-btn-radio=&quot;&#39;Droite&#39;&quot;&gt;Droite&lt;/label&gt;
&lt;/div&gt;</code></pre>
        </div>

        <div class="bs-callout bs-callout-info">
          <h4>Gestion de l'accès au clavier</h4>
          <p>Contrairement à la documentation AngularJS, on ne va pas utiliser des éléments <code lang="en">&lt;label&gt;</code> pour définir les boutons, car ces éléments ne sont pas accessibles au clavier, mais on va utiliser des éléments <code lang="en">&lt;button&gt;</code>.</p>
        </div>
        <div class="highlight-doc">
          <pre><code class="html" lang="en" ng-non-bindable>&lt;div class=&quot;btn-group&quot; role=&quot;radiogroup&quot; keyboard-rotate="{recursion: 0, autoClick: 1}"&gt;
  &lt;button class=&quot;btn btn-primary&quot; role=&quot;radio&quot; ng-model=&quot;radioModel&quot; uib-btn-radio=&quot;&#39;Gauche&#39;&quot;&gt;Gauche&lt;/button&gt;
  &lt;button class=&quot;btn btn-primary&quot; role=&quot;radio&quot; ng-model=&quot;radioModel&quot; uib-btn-radio=&quot;&#39;Centre&#39;&quot;&gt;Centre&lt;/button&gt;
  &lt;button class=&quot;btn btn-primary&quot; role=&quot;radio&quot; ng-model=&quot;radioModel&quot; uib-btn-radio=&quot;&#39;Droite&#39;&quot;&gt;Droite&lt;/button&gt;
&lt;/div&gt;</code></pre>
        </div>
        <div class="bs-callout bs-callout-info">
          <h4>Gestion de l'interaction au clavier</h4>
          <p>Pour pouvoir gérer correctement l'interaction au clavier avec les touches <kbd title="haut">↑</kbd>, <kbd title="bas">↓</kbd>, <kbd title="droite">→</kbd>, <kbd title="gauche">←</kbd>, on créé une directive <code lang="en">keyboardRotate</code> qu'on applique sur le composant principal (qui a la propriété <code lang="en">role="radiogroup"</code>). Cette directive écoute les événements au clavier mentionnés précédement, et suivant l'action effectuée, simule un clic (en appuyant sur <kbd title="espace">Espace</kbd> ou automatiquement suivant la configuration) sur le bouton suivant ou précédent (avec des tests si jamais on interagit sur le dernier bouton de la liste: l'utilisateur sera alors renvoyé sur le premier élément), et lui donne le focus. </p>

          <p>Une seconde directive est utilisée, et surcharge la directive existante <code lang="en">btnRadio</code>. Celle-ci s'occupe d'attribuer le paramètre <code lang="en">aria-checked</code> avec la valeur adéquate, et rend uniquement accessible au clavier l'élément sélectionné. Pour ne pas donner accès au clavier aux éléments non sélectionnés, c'est la propriété <code lang="en">tabindex="-1"</code> qui est utilisée.</p>
        </div>
        <div id="keyboard-rotate" class="bs-callout bs-callout-warning">
          <p>Pour la directive <code lang="en">keyboardRotate</code>, le paramètre <code lang="en">recursion</code> n'est pas utilisé dans cet exemple, mais est utilisé pour le composant <a href="#tabpanel_link" lang="en">tabpanel</a>. Il permet lorsqu'il est à 0 de se déplacer dans une liste d'élèments, et lorsqu'il est à 1 dans une liste imbriquée d'éléments. Il permet de naviguer correctement au clavier dans cette liste grace aux touches <kbd title="haut">↑</kbd>, <kbd title="bas">↓</kbd>, <kbd title="droite">→</kbd>, <kbd title="gauche">←</kbd>. Le paramètre <code lang="en">autoClick</code> permet de simuler un click automatiquement lors de la navigation lorsqu'il est à 1. Dans le cas contraire il faut appuyer sur la touche <kbd title="espace">Espace</kbd> afin de simuler un click</p>

        </div>
        <div class="highlight-doc">
          <pre><code class="js hljs javascript" lang="en" ng-non-bindable>a11yBootstrapModule.directive(&#39;keyboardRotate&#39;,[&#39;$document&#39;,&#39;$timeout&#39;,function($document,$timeout){
  return {
    priority: 200, //Make sure watches are fired after any other directives that affect the ngModel value
    restrict: &#39;A&#39;,
    scope: {
      param : &#39;@keyboardRotate&#39;,
    },
    link: function($scope, iElm, iAttrs, controller) {
      var {recursion, clickOption} = $scope.param;

      $timeout(function(){
        function KeyTrap (evt) {
          var next;
          var keyCode = evt.keyCode;

          if (clickOption === 1 && keyCode === 32) {
            evt.target.click();
          }
          //Right key and up key
          if (keyCode === 39 || keyCode === 40) {
            next = evt.target.nextElementSibling;
            if (recursion === 1) {
              next = evt.target.parentElement.nextElementSibling;
            }
            //if last go to first
            if (!next) {
              next = iElm.children()[0];
            }
          }
          //Left key and down key
          if (keyCode === 37 || keyCode === 38) {
            next = evt.target.previousElementSibling;
            if (recursion === 1) {
              next = evt.target.parentElement.previousElementSibling;
            }
            //if first go to last
            if (!next) {
              var child = iElm.children();
              next = child[child.length-1];
            }
          }
          //go to next element if defined (previous or next)
          if (next) {
            if (recursion === 1) {
              next = next.children[0];
            }
            next.focus();

            if (clickOption === 0) {
              next.click();
            }

          }
        }
        angular.element(iElm[0]).on('keydown', KeyTrap);
      },0);
    }
  };
}]).directive(&#39;uibBtnRadio&#39;, [function() {
  return {
    require: [&#39;uibBtnRadio&#39;, &#39;ngModel&#39;],
    priority: 200, //Make sure watches are fired after any other directives that affect the ngModel value
    link: function($scope, iElm, iAttrs, controller) {
      var buttonsCtrl = controller[0], ngModelCtrl = controller[1];

      //model -> UI
      ngModelCtrl.$render = function () {
        var check = angular.equals(ngModelCtrl.$modelValue, $scope.$eval(iAttrs.uibBtnRadio));

        iElm.attr('aria-checked', check);
        if (ngModelCtrl.$modelValue !== '') {
          iElm.attr('tabindex', '-1');
        }
        if (check) {
          iElm.attr('tabindex', '0');
        }
        iElm.toggleClass(buttonsCtrl.activeClass, angular.equals(ngModelCtrl.$modelValue, $scope.$eval(iAttrs.uibBtnRadio)));
      };

    }
  };</code></pre>
        </div>
      </article>

      <article>
        <header>
          <h2 id="checkbox_link" tabindex="-1" lang="en">Checkbox</h2>
        </header>

        <div>
          <h3>Démonstration</h3>


          <div class="bs-example" ng-controller="CheckboxButtonsCtrl">
            <h4>Une simple <span lang="en">checkbox</span></h4>
            <pre>{{singleModel}}</pre>
            <button role="checkbox" type="button" class="btn btn-primary" ng-model="singleModel" uib-btn-checkbox btn-checkbox-true="123" btn-checkbox-false="0">
              Simple
            </button>
            <h4 id="titre-checkbox">Un groupe de <span lang="en">checkbox</span></h4>
            <pre>{{checkModel}}</pre>
            <div role="group" aria-labelledby="titre-checkbox" class="btn-group">
              <button role="checkbox" class="btn btn-primary" ng-model="checkModel.left" uib-btn-checkbox>Gauche</button>
              <button role="checkbox" class="btn btn-primary" ng-model="checkModel.middle" uib-btn-checkbox>Centre</button>
              <button role="checkbox" class="btn btn-primary" ng-model="checkModel.right" uib-btn-checkbox>Droite</button>
            </div>
          </div>
        </div>

        <h3>Corrections</h3>

        <p>Plusieurs améliorations sont nécessaires pour rendre ce composant accessible&nbsp;:</p>

        <ul>
          <li>La checkbox doit posséder un attribut <code lang="en">role="checkbox"</code> ;</li>
          <li>La checkbox doit posséder un attribut <code lang="en">aria-checked</code> suivant l'état en cours ;</li>
          <li>L'élément structurant le groupe possède un <code lang="en">role="group"</code> ;</li>
          <li>L'élément structurant possède une propriété <code lang="en">aria-labelledby="[ID_titre]"</code> référençant le titre <code>role="group"</code> ;</li>
          <li>La touche <kbd>espace</kbd> permet de cocher/décocher la checkbox.</li>
        </ul>

        <p>
          Il faut dans un premier temps ajouter la sémantique, ce qui peut facilement être ajouté dans la partie HTML.
          On ajoute donc les attributs <code lang="en">role</code> et <code lang="en">aria-labelledby</code> en reprenant le titre.
        </p>

        <div class="highlight-doc">
          <pre>
            <code class="html" lang="en">
&lt;div role="group" aria-labelledby="titre-checkbox" class="btn-group">
  &lt;label role="checkbox" class="btn btn-primary" ng-model="checkModel.left" uib-btn-checkbox>Gauche&lt;/label>
  &lt;label role="checkbox" class="btn btn-primary" ng-model="checkModel.middle" uib-btn-checkbox>Centre&lt;/label>
  &lt;label role="checkbox" class="btn btn-primary" ng-model="checkModel.right" uib-btn-checkbox>Droite&lt;/label>
&lt;/div>
            </code>
          </pre>
        </div>

        <p>
          Pour gérer la touche <kbd>espace</kbd>, il suffit simplement de remplacer les balises <code lang="en">label</code> de la démo
          par des balises <code lang="en">button</code>.
        </p>

        <div class="highlight-doc">
          <pre>
            <code class="html" lang="en">
&lt;div role="group" aria-labelledby="titre-checkbox" class="btn-group">
  &lt;button role="checkbox" class="btn btn-primary" ng-model="checkModel.left" uib-btn-checkbox>Gauche&lt;/button>
  &lt;button role="checkbox" class="btn btn-primary" ng-model="checkModel.middle" uib-btn-checkbox>Centre&lt;/button>
  &lt;button role="checkbox" class="btn btn-primary" ng-model="checkModel.right" uib-btn-checkbox>Droite&lt;/button>
&lt;/div>
            </code>
          </pre>
        </div>

        <p>
          Il faut maintenant ajouter l'attribut <code lang="en">aria-checked</code> suivant l'état en cours.
          Malheuresement, la bibliothèque AngularUi ne partage pas cette valeur. On va donc réimplémenter une partie de la bibliothèque
          pour changer cet attribut. Notre directive doit avoir une priorité plus élevée, pour surcharger la contrôleur d'origine.
        </p>

        <div class="highlight-doc">
          <pre>
            <code class="js" lang="en">
a11yBootstrapModule.directive('uibBtnCheckbox', [function() {
  return {
    require: ['uibBtnCheckbox', 'ngModel'],
    priority: 200, //Make sure watches are fired after any other directives that affect the ngModel value
    link: function($scope, iElm, iAttrs, controller) {
      var buttonsCtrl = controller[0], ngModelCtrl = controller[1];

      function getTrueValue() {
        return getCheckboxValue(iAttrs.btnCheckboxTrue, true);
      }

      function getCheckboxValue(attributeValue, defaultValue) {
        var val = $scope.$eval(attributeValue);
        return angular.isDefined(val) ? val : defaultValue;
      }

      //model -> UI
      ngModelCtrl.$render = function () {
        var check = angular.equals(ngModelCtrl.$modelValue, getTrueValue());
        iElm.attr('aria-checked', check);
        iElm.toggleClass(buttonsCtrl.activeClass, check);
      };

    }
  };
}]);
            </code>
          </pre>
        </div>
      </article>

      <article>

        <h2 id="datepicker_link" tabindex="-1" lang="en">Datepicker</h2>

        <h3>Démonstration</h3>

        <div class="bs-example" ng-controller="DatepickerDemoCtrl">
          <pre>La date sélectionnée est : <em>{{dt | date:'fullDate' }}</em></pre>

          <h4 lang="en">Popup</h4>
          <div class="row">
            <div class="col-md-6">
              <label for="rg-from">Entrer une date :</label>
              <p class="input-group">
                <input id="rg-from" type="text" class="form-control" uib-datepicker-popup="{{format}}" ng-model="dt" is-open="opened" datepicker-options="dateOptions" ng-required="true" close-text="Close" />
                <span class="input-group-btn">
                  <button type="button" class="btn btn-default" ng-click="open($event)"><i class="glyphicon glyphicon-calendar"></i><span class="sr-only">Ouvrir le <span lang="en">datepicker</span></span></button>
                </span>
              </p>
            </div>
          </div>

          <hr />
          <button type="button" class="btn btn-sm btn-info" ng-click="today()">Aujourd'hui</button>
          <button type="button" class="btn btn-sm btn-default" ng-click="dt = '2009-08-24'">24/08/2009</button>
          <button type="button" class="btn btn-sm btn-danger" ng-click="clear()">Effacer</button>
        </div>

        <p>Pour ce composant, les erreurs relevées sont&nbsp;:</p>
        <ul>
          <li>Aucun titre de jour ne possède un attribut <code lang="en">role="columnheader"</code> ;</li>
          <li>Pour chaque jour, il ne possède pas d'attribut <code lang="en">aria-selected</code> suivant la selection en cours.</li>
        </ul>


        <h3>Corrections</h3>
        <div class="bs-callout bs-callout-info">
          <h4>Gestion des attributs dans le tableau des jours</h4>
          <p>On va surcharger le <span lang="en">template</span> de rendu du tableau des jours <code lang="en">template/datepicker/day.html</code>, et ajouter les attributs manquants <code lang="en">role="row”</code> sur les numéros de jours, et <code lang="en">role="columnheader"</code> sur les titres de jours.</p>
          <p>La surchage de ce <span lang="en">template</span> permet également de gérer des attributs dynamiques <code lang="en">aria-selected</code> et leur valeur <code lang="en">true</code> si le jour est sélectionné ou <code lang="en">false</code> si le jour n'est pas sélectionné.</p>
        </div>
        <div class="highlight-doc">
          <pre><code class="js" lang="en"  ng-non-bindable>
angular.module(&#39;uib/template/datepicker/day.html&#39;, []).run([&#39;$templateCache&#39;, function($templateCache) {
  $templateCache.put(
    'uib/template/datepicker/day.html',
    '&lt;table role=\"grid\" aria-labelledby=\"{{::uniqueId}}-title\" aria-activedescendant=\"{{activeDateId}}\"&gt;\n' +
    '  &lt;thead&gt;\n' +
    '    &lt;tr&gt;\n' +
    '      &lt;th&gt;&lt;button type=\"button\" class=\"btn btn-default btn-sm pull-left uib-left\" ng-click=\"move(-1)\" tabindex=\"-1\"&gt;&lt;i aria-hidden=\"true\" class=\"glyphicon glyphicon-chevron-left\"&gt;&lt;/i&gt;&lt;span class=\"sr-only\"&gt;previous&lt;/span&gt;&lt;/button&gt;&lt;/th&gt;\n' +
    '      &lt;th colspan=\"{{::5 + showWeeks}}\"&gt;&lt;button id=\"{{::uniqueId}}-title\" role=\"heading\" aria-live=\"assertive\" aria-atomic=\"true\" type=\"button\" class=\"btn btn-default btn-sm uib-title\" ng-click=\"toggleMode()\" ng-disabled=\"datepickerMode === maxMode\" tabindex=\"-1\"&gt;&lt;strong&gt;{{title}}&lt;/strong&gt;&lt;/button&gt;&lt;/th&gt;\n' +
    '      &lt;th&gt;&lt;button type=\"button\" class=\"btn btn-default btn-sm pull-right uib-right\" ng-click=\"move(1)\" tabindex=\"-1\"&gt;&lt;i aria-hidden=\"true\" class=\"glyphicon glyphicon-chevron-right\"&gt;&lt;/i&gt;&lt;span class=\"sr-only\"&gt;next&lt;/span&gt;&lt;/button&gt;&lt;/th&gt;\n' +
    '    &lt;/tr&gt;\n' +
    '    &lt;tr&gt;\n' +
    '      &lt;th ng-if=\"showWeeks\" class=\"text-center\"&gt;&lt;/th&gt;\n' +
    '      &lt;th role="columnheader" ng-repeat=\"label in ::labels track by $index\" class=\"text-center\"&gt;&lt;small aria-label=\"{{::label.full}}\"&gt;{{::label.abbr}}&lt;/small&gt;&lt;/th&gt;\n' +
    '    &lt;/tr&gt;\n' +
    '  &lt;/thead&gt;\n' +
    '  &lt;tbody&gt;\n' +
    '    &lt;tr class=\"uib-weeks\" ng-repeat=\"row in rows track by $index\" role=\"row\"&gt;\n' +
    '      &lt;td ng-if=\"showWeeks\" class=\"text-center h6\"&gt;&lt;em&gt;{{ weekNumbers[$index] }}&lt;/em&gt;&lt;/td&gt;\n' +
    '      &lt;td aria-selected="{{dt.selected}}" ng-repeat=\"dt in row\" class=\"uib-day text-center\" role=\"gridcell\"\n' +
    '        id=\"{{::dt.uid}}\"\n' +
    '        ng-class=\"::dt.customClass\"&gt;\n' +
    '        &lt;button type=\"button\" class=\"btn btn-default btn-sm\"\n' +
    '          uib-is-class=\"\n' +
    '            \'btn-info\' for selectedDt,\n' +
    '            \'active\' for activeDt\n' +
    '            on dt\"\n' +
    '          ng-click=\"select(dt.date)\"\n' +
    '          ng-disabled=\"::dt.disabled\"\n' +
    '          tabindex=\"-1\"&gt;&lt;span ng-class=\"::{\'text-muted\': dt.secondary, \'text-info\': dt.current}\"&gt;{{::dt.label}}&lt;/span&gt;&lt;/button&gt;\n' +
    '      &lt;/td&gt;\n' +
    '    &lt;/tr&gt;\n' +
    '  &lt;/tbody&gt;\n' +
    '&lt;/table&gt;\n' +
    '');
}]);
          </code></pre>
        </div>

      </article>

      <article>
        <h2>L'avis du développeur</h2>
        <blockquote>
        <p>
          Les corrections de sémantique peuvent être résolues assez simplement en modifiant les <span lang="en">templates</span>,
          si la bibliothèque d'origine expose correctement les données. La gestion au clavier peut se révéler
          plus compliquée à gérer, mais ce n'est néanmoins pas insurmontable dans l'exemple de cette bibliothèque.
          Certaines corrections ont parfois une approche assez détournée de la philosophie d'AngularJs et le mieux reste une correction complète dans la bibliothèque d'origine.
          Si la librairie de composant a encore de nombreuses erreurs; le framework AngularJs a fait un réel effort pour l'accessibilité à partir de la version 1.3 avec l'apparition de <a lang="en" href="https://code.angularjs.org/1.3.7/docs/guide/accessibility">ngAria</a>.
          La librairie <span lang="en">AngularJs Bootstrap</span> a également fourni des efforts en ce sens avec de nombreuses corrections et possède désormais un composant totalement accessible nativement (modal).
          Avec les dernières versions des bibliothèques, la plupart des corrections à apporter sur les composants sont mineures.
        </p>

        <a href="https://github.com/DISIC/rgaa_angular-bootstrap">
          Consulter le dépôt des corrections pour <span lang="en">Angular UI Bootstrap</span>
        </a>

        </blockquote>
      </article>

    </section>

  </main>

  <footer role="contentinfo" class="navbar navbar-default navbar-static-bottom small">
    <div class="container">
      <h2>
        Droits de reproduction
        <small>Ce document est placé sous <a href="http://www.etalab.gouv.fr/licence-ouverte-open-licence">licence ouverte 1.0 ou ultérieure</a></small>
      </h2>
      <div class="row">
        <div class="col-md-1">
          <img src="../modernisation-logo.jpg" alt="Secrétariat général pour la modernisation de l'action publique" class="navbar-left">
        </div>
        <div class="col-md-5">
          <p class="clear">Vous êtes libres de&nbsp;:</p>
          <ul>
            <li>Reproduire, copier, publier et transmettre ces informations ;</li>
            <li>Diffuser et redistribuer ces informations ;</li>
            <li>Adapter, modifier, extraire et transformer ces informations, notamment pour créer des informations dérivées ;</li>
            <li>Exploiter ces informations à titre commercial, par exemple en la combinant avec d'autres informations, ou en l'incluant dans votre propre produit ou application.</li>
          </ul>
        </div>
        <div class="col-md-6">
          <p>Ces libertés s'appliquent sous réserve de mentionner la paternité de l'information d'origine&nbsp;: sa source et la date de sa dernière mise à jour. Le réutilisateur peut notamment s'acquitter de cette condition en indiquant un ou des liens hypertextes (URL) renvoyant vers le présent site et assurant une mention effective de sa paternité.</p><p>Cette mention de paternité ne doit ni conférer un caractère officiel à la réutilisation de ces informations, ni suggérer une quelconque reconnaissance ou caution par le producteur de l'information, ou par toute autre entité publique, du réutilisateur ou de sa réutilisation.</p>
        </div>
      </div>
    </div>
  </footer>

  <script src="../dist/angular.js"></script>
  <script src="../dist/angular-ui-bootstrap.js"></script>
  <script src="../dist/highlight.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <script src="../dist/rgaa-angular-bootstrap.js"></script>
</body>
</html>
